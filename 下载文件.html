<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    progress {
      width: 100%;
      height: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f5f5f5;
    }
    progress::-webkit-progress-bar {
      background-color: #f5f5f5;
      border-radius: 8px;
    }
    progress::-webkit-progress-value {
      background-color: #0077ff;
      border-radius: 8px;
    }
  </style>
  <body>
    <button id="downloadBtn">下载</button>
    <progress id="progressBar" value="0" max="100"></progress>
  </body>
  <script>
    const downloadBtn = document.getElementById("downloadBtn");
    const progressBar = document.getElementById("progressBar");

    downloadBtn.addEventListener("click", () => {
      downloadFile();
    });

    function downloadFile() {
      let downloadURL = "https://alifile.xiaocaiyin.com/uploads/file/VO202305/temp/2023052543190758/PO2023052212885319.pdf"; // 下载链接
      let xhr = new XMLHttpRequest(); // 创建 XMLHttpRequest 对象
      xhr.open("GET", downloadURL, true); // 打开请求链接
      xhr.responseType = "blob"; // 设置响应类型为二进制数据

      xhr.onload = function () {
        if (xhr.status === 200) {
          console.log(xhr.response);
          let blob = xhr.response; // 获取响应数据
          let link = document.createElement("a"); // 创建一个 a 标签
          link.href = window.URL.createObjectURL(blob); // 设置下载链接
          link.download = "dy.mp4"; // 设置下载文件名
          link.click(); // 模拟用户单击下载链接
        }
      };

      xhr.onprogress = function (event) {
        console.log(event);
        // lengthComputable 表示ProgressEvent 所关联的资源是否具有可以计算的长度
        if (event.lengthComputable) {
          // 计算下载进度
          const percent = (event.loaded / event.total) * 100;
          // 更新进度条
          document.getElementById("progressBar").value = percent;
        }
      };

      xhr.send(); // 发送请求
    }
  </script>
</html>
